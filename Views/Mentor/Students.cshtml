@model List<SPT.Models.ViewModels.StudentPerformanceViewModel>
@{
    ViewData["Title"] = "My Students";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="fw-bold"><i class="fas fa-chalkboard-teacher me-2"></i> My Assigned Students</h4>
</div>

<div class="custom-card p-0 overflow-hidden">
    <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
            <thead class="bg-light text-muted small text-uppercase">
                <tr>
                    <th class="ps-4">Student Name</th>
                    <th>Cohort</th>
                    <th>Track</th>
                    <th class="text-center">Hrs (7d)</th>
                    <th>Progress</th>
                    <th>Status</th>
                    <th>Consistency</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var s in Model)
                {
                    <tr>
                        <td class="ps-4">
                            <div class="d-flex align-items-center">
                                <img src="@(s.ProfilePicture ?? "/images/default-avatar.png")" class="rounded-circle me-3 border" style="width:35px;height:35px;object-fit:cover;">
                                <div>
                                    <span class="d-block fw-bold">@s.FullName</span>
                                    <small class="text-muted">@s.Email</small>
                                </div>
                            </div>
                        </td>
                        <td>@s.CohortName</td>
                        <td><span class="badge bg-light text-dark border">@s.TrackCode</span></td>

                        <td class="text-center">
                            <strong>@s.HoursLast7Days</strong>
                            <div class="small text-muted">@s.CheckInsLast7Days check-ins</div>
                        </td>

                        <td style="width: 150px;">
                            <div class="d-flex justify-content-between small mb-1">
                                <span>@s.CompletedModules / @s.TotalModules</span>
                            </div>
                            @{
                                double modProgress = s.TotalModules == 0 ? 0 : ((double)s.CompletedModules / s.TotalModules) * 100;
                            }
                            <div class="progress" style="height: 6px;">
                                <div class="progress-bar bg-primary" role="progressbar" style="width: @modProgress%"></div>
                            </div>
                        </td>

                        <td>
                            @if (s.Status == "Active")
                            {
                                <span class="badge bg-success">Active</span>
                            }
                            else if (s.Status == "At Risk")
                            {
                                <span class="badge bg-danger">At Risk</span>
                            }
                            else
                            {
                                <span class="badge bg-secondary">Inactive</span>
                            }
                        </td>

                        <td style="width: 120px;">
                            <div class="d-flex align-items-center">
                                <div class="progress flex-grow-1 me-2" style="height: 6px;">
                                    @{
                                        string barColor = s.ConsistencyScore >= 75 ? "bg-primary" : (s.ConsistencyScore >= 40 ? "bg-warning" : "bg-danger");
                                    }
                                    <div class="progress-bar @barColor" role="progressbar" style="width: @s.ConsistencyScore%"></div>
                                </div>
                                <small class="fw-bold">@s.ConsistencyScore%</small>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>