@model List<SPT.Models.ProgressLog>
@{
    ViewData["Title"] = "Admin Dashboard";
}

<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="custom-card d-flex align-items-center justify-content-between p-4 h-100">
            <div>
                <h6 class="text-muted text-uppercase fw-bold mb-1" style="font-size: 0.75rem;">Active Students</h6>
                <h2 class="mb-0 fw-bold text-dark">@ViewBag.TotalStudents</h2>
            </div>
            <div class="icon-btn bg-primary text-white" style="width: 50px; height: 50px; font-size: 1.5rem;">
                <i class="fas fa-user-graduate"></i>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="custom-card d-flex align-items-center justify-content-between p-4 h-100">
            <div>
                <h6 class="text-muted text-uppercase fw-bold mb-1" style="font-size: 0.75rem;">Pending Logs</h6>
                <h2 class="mb-0 fw-bold text-warning">@ViewBag.PendingLogs</h2>
            </div>
            <div class="icon-btn bg-warning text-dark" style="width: 50px; height: 50px; font-size: 1.5rem;">
                <i class="fas fa-clock"></i>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="custom-card d-flex align-items-center justify-content-between p-4 h-100">
            <div>
                <h6 class="text-muted text-uppercase fw-bold mb-1" style="font-size: 0.75rem;">Open Tickets</h6>
                <h2 class="mb-0 fw-bold text-danger">@ViewBag.OpenTickets</h2>
            </div>
            <div class="icon-btn bg-danger text-white" style="width: 50px; height: 50px; font-size: 1.5rem;">
                <i class="fas fa-envelope-open-text"></i>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="custom-card d-flex align-items-center justify-content-between p-4 h-100">
            <div>
                <h6 class="text-muted text-uppercase fw-bold mb-1" style="font-size: 0.75rem;">Mentors</h6>
                <h2 class="mb-0 fw-bold text-success">@ViewBag.TotalMentors</h2>
            </div>
            <div class="icon-btn bg-success text-white" style="width: 50px; height: 50px; font-size: 1.5rem;">
                <i class="fas fa-chalkboard-teacher"></i>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-lg-8">
        <div class="custom-card h-100">
            <h5 class="card-title-custom mb-3 border-0">📈 Learning Activity (Last 7 Days)</h5>
            <div style="height: 300px;">
                <canvas id="activityChart"></canvas>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="custom-card h-100">
            <h5 class="card-title-custom mb-3 border-0">🎓 Students per Track</h5>
            <div style="height: 250px; position: relative;">
                <canvas id="trackChart"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">

    <div class="col-lg-8">
        <div class="custom-card h-100">
            <div class="d-flex justify-content-between align-items-center mb-4 pb-2 border-bottom">
                <h5 class="card-title-custom mb-0 border-0">📄 Recent Logs Needing Review</h5>
                <a asp-action="PendingLogs" class="btn btn-sm btn-outline-primary rounded-pill px-3">View All</a>
            </div>

            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light">
                        <tr class="text-muted small text-uppercase">
                            <th>Student</th>
                            <th>Module</th>
                            <th>Date</th>
                            <th class="text-center">Hours</th>
                            <th class="text-end">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model != null && Model.Any())

                        {

                            foreach (var log in Model)

                            {
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="avatar-circle bg-light text-primary me-3 fw-bold shadow-sm" 
                                                         style="width:35px;height:35px;display:flex;align-items:center;justify-content:center;border-radius:50%;">
                                                @(log.Student?.FullName.Substring(0, 1) ?? "?")
                                                    </div>
                                                    <div>
                                                        <span class="d-block fw-bold text-dark" style="font-size: 0.9rem;">@log.Student?.FullName</span>
                                                        <span class="d-block text-muted small" style="font-size:0.75rem;">@log.Student?.Cohort?.Name</span>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="badge bg-light text-dark border">@log.Module?.ModuleCode</span>
                                            </td>
                                            <td class="text-muted small">@log.Date.ToString("MMM dd")</td>
                                            <td class="text-center fw-bold">@log.Hours</td>
                                            <td class="text-end">
                                                <form asp-action="ApproveLog" method="post" class="d-inline">
                                                    <input type="hidden" name="id" value="@log.Id" />
                                                    <button type="submit" class="btn btn-sm btn-success shadow-sm rounded-circle" 
                                                            style="width: 32px; height: 32px;" title="Quick Approve">
                                                        <i class="fas fa-check"></i>
                                                    </button>
                                                </form>
                                            </td>
                                        </tr>
                            }

                        }

                        else

                        {
                                <tr>
                                    <td colspan="5" class="text-center py-5 text-muted">
                                        <div class="mb-3">
                                            <i class="fas fa-check-circle fa-3x text-success opacity-50"></i>
                                        </div>
                                        <h6 class="fw-bold">All Caught Up!</h6>
                                        <p class="mb-0 small">No pending logs requiring approval.</p>
                                    </td>
                                </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="custom-card">
            <h5 class="card-title-custom">⚡ Quick Actions</h5>

            <div class="d-grid gap-3 mt-3">

                @if (User.IsInRole("Admin"))

                {
                        <a asp-action="CreateStudent" class="btn btn-light text-start p-3 border shadow-sm d-flex align-items-center transition-hover">
                            <div class="icon-btn bg-primary text-white me-3 shadow-sm"><i class="fas fa-user-plus"></i></div>
                            <div>
                                <span class="d-block fw-bold text-dark">Create New Student</span>
                                <small class="text-muted">Register user & assign track</small>
                            </div>
                        </a>

                        <a asp-action="CreateMentor" class="btn btn-light text-start p-3 border shadow-sm d-flex align-items-center transition-hover">
                            <div class="icon-btn bg-dark text-white me-3 shadow-sm"><i class="fas fa-chalkboard-teacher"></i></div>
                            <div>
                                <span class="d-block fw-bold text-dark">Add Mentor</span>
                                <small class="text-muted">Onboard new staff</small>
                            </div>
                        </a>

                        <a asp-action="CreateAnnouncement" class="btn btn-light text-start p-3 border shadow-sm d-flex align-items-center transition-hover">
                            <div class="icon-btn bg-warning text-white me-3 shadow-sm"><i class="fas fa-bullhorn"></i></div>
                            <div>
                                <span class="d-block fw-bold text-dark">Broadcast News</span>
                                <small class="text-muted">Notify students/mentors</small>
                            </div>
                        </a>
                }

                <a asp-controller="Support" asp-action="Index" class="btn btn-light text-start p-3 border shadow-sm d-flex align-items-center transition-hover">
                    <div class="icon-btn bg-secondary text-white me-3 shadow-sm"><i class="fas fa-headset"></i></div>
                    <div>
                        <span class="d-block fw-bold text-dark">Support Center</span>
                        <small class="text-muted">Reply to open tickets</small>
                    </div>
                </a>
            </div>
        </div>

        <div class="custom-card mt-4 bg-primary text-white position-relative overflow-hidden border-0">
            <div style="position: relative; z-index: 2;">
                <h5 class="fw-bold mb-3">System Status</h5>
                <div class="d-flex justify-content-between border-bottom border-white border-opacity-25 pb-2 mb-2">
                    <span>Server Time</span>
                    <span class="font-monospace">@DateTime.UtcNow.ToString("HH:mm") UTC</span>
                </div>
                <div class="d-flex justify-content-between">
                    <span>Database</span>
                    <span class="badge bg-success">Connected</span>
                </div>
            </div>
            <i class="fas fa-server position-absolute" style="font-size: 8rem; opacity: 0.1; right: -20px; bottom: -20px;"></i>
        </div>
    </div>
</div>

<style>
    .transition-hover {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .transition-hover:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1) !important;
        background-color: #fff !important; 
        border-color: var(--primary-color) !important;
    }
</style>